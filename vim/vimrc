" Vundle
" PluginInstall to install
" PluginUpdate to update
filetype off

set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()

Plugin 'VundleVim/Vundle.vim'

" Editing
" ----------------------------
Plugin 'ntpeters/vim-better-whitespace'
Plugin 'scrooloose/nerdcommenter'
Plugin 'tpope/vim-surround'
Plugin 'valloric/youcompleteme'
Plugin 'w0rp/ale' " asynch linting

" Git
" ----------------------------
Plugin 'tpope/vim-fugitive'

" TMUX
" ----------------------------
Plugin 'benmills/vimux'
Plugin 'christoomey/vim-tmux-navigator'

" Navigation
" ----------------------------
Plugin 'kien/ctrlp.vim'
Plugin 'scrooloose/nerdtree'

" Search
" ----------------------------
Plugin 'dyng/ctrlsf.vim'
Plugin 'petdance/ack2'

" Languages
" ----------------------------
" Plugin 'Quramy/tsuquyomi'
" Plugin 'sheerun/vim-polyglot' " messing up js indenting
Plugin 'Valloric/MatchTagAlways'
Plugin 'fatih/vim-go'
Plugin 'leafgarland/typescript-vim'
Plugin 'mxw/vim-jsx'
Plugin 'othree/html5.vim'
Plugin 'pangloss/vim-javascript'
Plugin 'stanangeloff/php.vim'

" Colors
" ----------------------------
" Plugin 'dracula/vim'
" Plugin 'flazz/vim-colorschemes'
Plugin 'vim-airline/vim-airline'
Plugin 'airblade/vim-gitgutter'
" Plugin 'itchyny/lightline.vim'
Plugin 'joshdick/onedark.vim'

call vundle#end()

" ----------------------------
" General
" ----------------------------

" Change the mapleader from \ to ,
let mapleader=","

" Detect filetypes
filetype plugin indent on

" Allow access to system clipboard
set clipboard=unnamed

" Vim does not need to be compaible with vi
set nocompatible

" Enable syntax highlighting
if !exists("g:syntax_on")
    syntax enable
endif

" Color scheme, favorites: darkburn, onedark
colorscheme onedark

" Rendering
set lazyredraw " only redraw during typing
set ttyfast " smoother redrawing

" Buffers
set hidden " hide buffers instead of closing
set noswapfile " don't use swap files

" Visual
set colorcolumn=100 " Show max line length marker
set number " Show absolute line number on current line
set relativenumber " Show relative line numbers
set ruler " Show ruler
set showcmd " Show current command
set showmatch " show matching brackets

" Error sounds
set visualbell
set noerrorbells " don't beep

" Text
match ErrorMsg '\s\+$' " Highlight trailing white space
set autoindent " auto indent
set diffopt+=vertical " Open diffs vertically
set expandtab " insert spaces with tab
set nowrap " do not wrap words (view)
set shiftwidth=2 " number of spaces for autoident
set spelllang=en " spell checker
set tabstop=2 " one tab is 4 spaces
set textwidth=0 " do not wrap words (insert)
set conceallevel=1 " enable concealing characters

" Save temp files in a global directory
set directory=~/.vim/tmp
set backupdir=~/.vim/tmp

" Source .vimrc after saving it
" Airline disapears on save without a refresh
" vim-better-whitespace stops highlighting as well
if has("autocmd")
    autocmd! BufWritePost *vimrc source $MYVIMRC | AirlineRefresh
endif

" Search
set gdefault
set ignorecase " ignore casing in search
set smartcase " unless search contains a capital
set hlsearch

" ----------------------------
" Colors
" ----------------------------

"Use 24-bit (true-color) mode in Vim/Neovim when outside tmux.
"If you're using tmux version 2.2 or later, you can remove the outermost $TMUX check and use tmux's 24-bit color support
"(see < http://sunaku.github.io/tmux-24bit-color.html#usage > for more information.)
if (empty($TMUX))
  if (has("nvim"))
    "For Neovim 0.1.3 and 0.1.4 < https://github.com/neovim/neovim/pull/2198 >
    let $NVIM_TUI_ENABLE_TRUE_COLOR=1
  endif
  "For Neovim > 0.1.5 and Vim > patch 7.4.1799 < https://github.com/vim/vim/commit/61be73bb0f965a895bfb064ea3e55476ac175162 >
  "Based on Vim patch 7.4.1770 (`guicolors` option) < https://github.com/vim/vim/commit/8a633e3427b47286869aa4b96f2bfc1fe65b25cd >
  " < https://github.com/neovim/neovim/wiki/Following-HEAD#20160511 >
  if (has("termguicolors"))
    set termguicolors
  endif
endif

let g:airline_section_y = ''
let g:airline_section_z = airline#section#create(['linenr', ' :%3v'])
let g:airline_theme='onedark'

set laststatus=2
colorscheme onedark

" ----------------------------
" Bindings
" ----------------------------

" Clear search highlighting
nnoremap <backspace> :noh<CR>:<backspace>

" Don't jump on hlsearch
nnoremap * *``

" Pretty-print JSON with \j. Works on a selection or a whole buffer.
nnoremap <leader>j :%!python -m json.tool<CR>:set ft=javascript<CR>
vnoremap <leader>j :!python -m json.tool<CR>:set ft=javascript<CR>

" ----------------------------
" Bundles
" ----------------------------

" You complete me
set completeopt-=preview
if !exists("g:ycm_semantic_triggers")
  let g:ycm_semantic_triggers = {}
endif
let g:ycm_min_num_of_chars_for_completion = 2

" Tmux navigator
let g:tmux_navigator_no_mappings = 1
nnoremap <silent> <C-h> :TmuxNavigateLeft<cr>
nnoremap <silent> <C-j> :TmuxNavigateDown<cr>
nnoremap <silent> <C-k> :TmuxNavigateUp<cr>
nnoremap <silent> <C-l> :TmuxNavigateRight<cr>
nnoremap <silent> <C-\> :TmuxNavigatePrevious<cr>

" NerdTree
" set autoread
" autocmd vimenter * NERDTree
autocmd StdinReadPre * let s:std_in=1
autocmd VimEnter * if argc() == 0 && !exists("s:std_in") | NERDTree | endif

" Statusline
set statusline+=%#warningmsg#
set statusline+=%*

" Ctrlsf
nmap <C-S> <Plug>CtrlSFPrompt
let g:ctrlsf_default_root = 'project'
let g:ctrlsf_winsize = '70%'
let g:ctrlsf_ackprg = "/usr/local/bin/ack"

" w0rp/ale
" let g:ale_lint_delay = '500'
let g:ale_javascript_eslint_executable = '/Users/trevor/.yarn/bin/eslint'
let g:ale_lint_on_enter = 0
let g:ale_sign_column_always = 1
let g:ale_sign_error = '●'

" Quramy/tsuquyomi
autocmd QuickFixCmdPost [^l]* nested cwindow " make Quickfix window appear
autocmd QuickFixCmdPost    l* nested lwindow " make Quickfix window appear

" Nerd Commenter
let g:NERDSpaceDelims = 1
let g:NERDCompactSexyComs = 1
let g:NERDDefaultAlign = 'left'
let g:NERDAltDelims_java = 1
let g:NERDCustomDelimiters = { 'c': { 'left': '/**','right': '*/' } }
let g:NERDCommentEmptyLines = 1
let g:NERDTrimTrailingWhitespace = 1

" CtrlP
let g:ctrlp_map = '<c-p>'
let g:ctrlp_cmd = 'CtrlP'
set wildignore+=*/tmp/*,*.so,*.swp,*.zip

" benmills/vimux
" Prompt for a command to run
map <Leader>vp :VimuxPromptCommand<CR>

" pangloss/vim-javascript
let g:javascript_conceal_arrow_function = "⇒"

" mxw/vim-jsx
let g:jsx_ext_required = 0

" Valloric/MatchTagAlways
let g:mta_filetypes = {
    \ 'html' : 1,
    \ 'php' : 1,
    \ 'javascript.jsx' : 1,
    \ 'markdown' : 1,
    \ 'xhtml' : 1,
    \ 'xml' : 1,
    \}

" ----------------------------
" Gui
" ----------------------------

set guifont=Menlo\ Regular:h14 " font
set guioptions-=m  "remove menu bar
set guioptions-=T  "remove toolbar
set guioptions-=r  "remove right-hand scroll bar
set guioptions-=L  "remove left-hand scroll bar

" ----------------------------
" Languages
" ----------------------------

" Go
" Use tabs, displayed as 8 spaces
au BufNewFile,BufRead *.go setlocal noet tabstop=4 shiftwidth=4 softtabstop=4
let g:go_fmt_fail_silently = 1
let g:go_list_type = ""
